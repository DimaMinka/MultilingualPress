!function(a){"use strict";var b=Backbone.Router.extend({}),c=function(){var c=[],d={},e=new b,f=function(a,b){d[b]?d[b].modules.push(a):d[b]={modules:[a]}},g=function(){a.each(d,function(b,d){e.route(b,b,function(){a.each(d.modules,function(a,b){c[b.name]=new b.Callback(b.options)})})})};return{Events:_.extend({},Backbone.Events),Modules:c,getSettings:function(a){return"undefined"!=typeof window["mlp"+a+"Settings"]?window["mlp"+a+"Settings"]:"undefined"!=typeof window[a]?window[a]:{}},registerModule:function(b,c,d,e){var g={name:c,Callback:d,options:e||{}};a.each(_.isArray(b)?b:[b],function(a,b){f(g,b)})},initialize:function(){g(),Backbone.history.start({root:mlpSettings.urlRoot,pushState:!0,hashChange:!1})}}};window.MultilingualPress=new c,a(window.MultilingualPress.initialize)}(jQuery),function(a,b){"use strict";var c=Backbone.View.extend({initialize:function(){this.initializeStateTogglers()},initializeStateTogglers:function(){a(".mlp-state-toggler").each(function(b,c){var d=a(c);a('[name="'+d.attr("name")+'"]').on("change",{$toggler:d},this.toggleElementIfChecked)}.bind(this))},toggleElementIfChecked:function(b){var c=b.data.$toggler,d=c.data("toggle-target");d&&a(d).toggle(c.is(":checked"))},toggleElement:function(b){var c=a(b.target).data("toggle-target")||"";c&&a(c).toggle()}});b.Modules.Common=new c({el:"body",events:{"click .mlp-click-toggler":"toggleElement"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=b.getSettings("NavMenus"),d=Backbone.Model.extend({urlRoot:ajaxurl}),e=Backbone.View.extend({initialize:function(){this.$languages=this.$el.find('li [type="checkbox"]'),this.$menu=a("#menu"),this.$menuToEdit=a("#menu-to-edit"),this.$spinner=this.$el.find(".spinner"),this.$submit=this.$el.find("#submit-mlp-language"),this.model=new d,this.listenTo(this.model,"change",this.render)},sendRequest:function(a){var b={action:c.action,menu:this.$menu.val(),mlp_sites:this.getSites()};b[c.nonceName]=c.nonce,a.preventDefault(),this.$submit.prop("disabled",!0),this.$spinner.addClass("is-active"),this.model.fetch({data:b,processData:!0})},getSites:function(){var b=[];return this.$languages.filter(":checked").each(function(){b.push(Number(a(this).val()||0))}),b},render:function(){this.model.get("success")&&this.$menuToEdit.append(this.model.get("data")),this.$languages.prop("checked",!1),this.$spinner.addClass("is-active"),this.$submit.prop("disabled",!1)}});b.registerModule("nav-menus.php","NavMenus",e,{el:"#"+c.metaBoxID,events:{"click #submit-mlp-language":"sendRequest"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=Backbone.View.extend({initialize:function(){this.template=_.template(a("#mlp-add-new-site-template").html()||""),this.render(),this.$language=a("#mlp-site-language"),this.$pluginsRow=a("#mlp-activate-plugins").closest("tr")},render:function(){this.$el.find(".submit").before(this.template())},adaptLanguage:function(b){var c=this.getLanguage(a(b.target));this.$language.find('[value="'+c+'"]').length&&this.$language.val(c)},getLanguage:function(a){var b=a.val();return b?b.replace("_","-"):"en-US"},togglePluginsRow:function(b){this.$pluginsRow.toggle(0<a(b.target).val())}});b.registerModule("network/site-new.php","AddNewSite",c,{el:"#wpbody-content form",events:{"change #site-language":"adaptLanguage","change #mlp-base-site-id":"togglePluginsRow"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=b.getSettings("CopyPost"),d=Backbone.Model.extend({urlRoot:ajaxurl}),e=Backbone.View.extend({initialize:function(){this.$content=a("#content"),this.$excerpt=a("#excerpt"),this.$title=a("#title"),this.model=new d,this.listenTo(this.model,"change",this.updatePostData),this.postID=Number(a("#post_ID").val())},copyPostData:function(d){var e={},f=this.getRemoteSiteID(a(d.target));d.preventDefault(),a("#mlp-translation-data-"+f+"-copied-post").val(1),b.Events.trigger("CopyPost:copyPostData",e,c.siteID,this.postID,f),e=_.extend(e,{action:c.action,current_post_id:this.postID,remote_site_id:f,title:this.getTitle(),slug:this.getSlug(),content:this.getContent(),excerpt:this.getExcerpt()}),this.model.fetch({data:e,processData:!0})},getRemoteSiteID:function(a){return a.data("site-id")||0},getTitle:function(){return this.$title.val()||""},getSlug:function(){return a("#editable-post-name-full").text()||""},getContent:function(){return this.$content.val()||""},getExcerpt:function(){return this.$excerpt.val()||""},updatePostData:function(){var c,d;this.model.get("success")&&(c=this.model.get("data"),d="mlp-translation-data-"+c.siteID+"-",a("#"+d+"title").val(c.title),a("#"+d+"name").val(c.slug),this.setTinyMCEContent(d+"content",c.content),a("#"+d+"content").val(c.content),a("#"+d+"excerpt").val(c.excerpt),b.Events.trigger("CopyPost:updatePostData",c))},setTinyMCEContent:function(a,b){var c;"undefined"!=typeof window.tinyMCE&&(c=window.tinyMCE.get(a),c&&c.setContent(b))}});b.registerModule(["post.php","post-new.php"],"CopyPost",e,{el:"#post-body",events:{"click .mlp-copy-post-button":"copyPostData"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=b.getSettings("RelationshipControl"),d=Backbone.View.extend({initialize:function(){this.unsavedRelationships=[],this.initializeEventHandlers()},initializeEventHandlers:function(){b.Events.on({"RelationshipControl:connectExistingPost":this.connectExistingPost,"RelationshipControl:connectNewPost":this.connectNewPost,"RelationshipControl:disconnectPost":this.disconnectPost},this)},updateUnsavedRelationships:function(b){var c=a(b.target),d=c.closest(".mlp-translation-meta-box"),e=d.find(".mlp-save-relationship-button"),f=this.findMetaBox(d);"stay"===c.val()?(e.prop("disabled","disabled"),-1!==f&&this.unsavedRelationships.splice(f,1)):-1===f&&(this.unsavedRelationships.push(d),e.removeAttr("disabled"))},findMetaBox:function(b){return a.each(this.unsavedRelationships,function(a,c){return c===b?a:void 0}),-1},confirmUnsavedRelationships:function(a){this.unsavedRelationships.length&&!window.confirm(c.L10n.unsavedRelationships)&&a.preventDefault()},saveRelationship:function(c){var d=a(c.target),e=d.data("remote-site-id"),f=a('input[name="mlp-rc-action['+e+']"]:checked').val(),g=this.getEventName(f);"stay"!==f&&(d.prop("disabled","disabled"),b.Events.trigger("RelationshipControl:"+g,{action:"mlp_rc_"+f,remote_site_id:e,remote_post_id:d.data("remote-post-id"),source_site_id:d.data("source-site-id"),source_post_id:d.data("source-post-id")},g))},getEventName:function(a){switch(a){case"search":return"connectExistingPost";case"new":return"connectNewPost";case"disconnect":return"disconnectPost";default:return""}},connectNewPost:function(b){b.new_post_title=a('input[name="post_title"]').val(),this.sendRequest(b)},disconnectPost:function(a){this.sendRequest(a)},connectExistingPost:function(b){var d=a('input[name="mlp_add_post['+b.remote_site_id+']"]:checked').val()||0;d?(b.new_post_id=Number(d),this.sendRequest(b)):window.alert(c.L10n.noPostSelected)},sendRequest:function(b){a.ajax({type:"POST",url:ajaxurl,data:b,success:this.reloadLocation,async:!1})},reloadLocation:function(){window.location.reload(!0)}});b.registerModule(["post.php","post-new.php"],"RelationshipControl",d,{el:"body",events:{"change .mlp-rc-actions input":"updateUnsavedRelationships","click #publish":"confirmUnsavedRelationships","click .mlp-save-relationship-button":"saveRelationship"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=b.getSettings("RemotePostSearch"),d=Backbone.Model.extend({urlRoot:ajaxurl}),e=Backbone.View.extend({initialize:function(){this.defaultResults=[],this.resultsContainers=[],this.searchThreshold=parseInt(c.searchThreshold,10),this.model=new d,this.listenTo(this.model,"change",this.render),this.initializeResults()},initializeResults:function(){a(".mlp-search-field").each(function(b,c){var d=a(c),e=a("#"+d.data("results-container-id")),f=d.data("remote-site-id");this.defaultResults[f]=e.html(),this.resultsContainers[f]=e}.bind(this))},preventFormSubmission:function(a){13===a.which&&a.preventDefault()},reactToInput:function(b){var c,d=a(b.target),e=a.trim(d.val()||"");e!==d.data("value")&&(clearTimeout(this.reactToInputTimer),d.data("value",e),c=d.data("remote-site-id"),""===e?this.resultsContainers[c].html(this.defaultResults[c]):e.length>=this.searchThreshold&&(this.reactToInputTimer=setTimeout(function(){this.model.fetch({data:{action:"mlp_rc_remote_post_search",remote_site_id:c,remote_post_id:d.data("remote-post-id"),source_site_id:d.data("source-site-id"),source_post_id:d.data("source-post-id"),s:e},processData:!0})}.bind(this),400)))},render:function(){var a;this.model.get("success")&&(a=this.model.get("data"),this.resultsContainers[a.remoteSiteID].html(a.html))}});b.registerModule(["post.php","post-new.php"],"RemotePostSearch",e,{el:"body",events:{"keydown .mlp-search-field":"preventFormSubmission","keyup .mlp-search-field":"reactToInput"}})}(jQuery,window.MultilingualPress),function(a,b){"use strict";var c=Backbone.View.extend({initialize:function(){this.$selects=this.$el.find("select"),this.isPropagating=!1},propagateSelectedTerm:function(b){var c,d;this.isPropagating||(this.isPropagating=!0,c=a(b.target),d=this.getSelectedRelation(c),""!==d&&this.$selects.not(c).each(function(b,c){this.selectTerm(a(c),d)}.bind(this)),this.isPropagating=!1)},getSelectedRelation:function(a){return a.find("option:selected").data("relation")||""},selectTerm:function(a,b){var c=a.find('option[data-relation="'+b+'"]');c.length?a.val(c.val()):this.getSelectedRelation(a)&&a.val(a.find("option").first().val())}});b.registerModule("edit-tags.php","TermTranslator",c,{el:"#mlp-term-translations",events:{"change select":"propagateSelectedTerm"}})}(jQuery,window.MultilingualPress),function(a){"use strict";var b=a.getSettings("UserBackendLanguage"),c=Backbone.View.extend({initialize:function(){this.$el.val(b.locale)}});a.registerModule("options-general.php","UserBackendLanguage",c,{el:"#WPLANG"})}(window.MultilingualPress);