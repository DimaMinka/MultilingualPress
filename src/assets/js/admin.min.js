!function(a){"use strict";var b=Backbone.Router.extend({}),c=function(){var c=[],d=new b;return{Modules:c,getSettings:function(a){return"undefined"!=typeof window["mlp"+a+"Settings"]?window["mlp"+a+"Settings"]:"undefined"!=typeof window[a]?window[a]:{}},registerModule:function(b,e,f,g){_.isFunction(f)&&(g=g||{},a.each(_.isArray(b)?b:[b],function(a,b){d.route(b,e,function(){c[e]=new f(g)})}))},initialize:function(){Backbone.history.start({root:mlpSettings.adminUrl,pushState:!0,hashChange:!1})}}};window.MultilingualPress=new c,a(window.MultilingualPress.initialize)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"body",events:{"click .mlp-click-toggler":"toggleElement"},initialize:function(){this.initializeStateTogglers()},initializeStateTogglers:function(){a(".mlp-state-toggler").each(function(b,c){var d=a(c);a('[name="'+d.attr("name")+'"]').on("change",{$toggler:d},this.toggleElementIfChecked)}.bind(this))},toggleElementIfChecked:function(b){var c=b.data.$toggler,d=c.data("toggle-target");d&&a(d).toggle(c.is(":checked"))},toggleElement:function(b){var c=a(b.target).data("toggle-target")||"";c&&a(c).toggle()}});MultilingualPress.Modules.Common=new b}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("NavMenus"),c=Backbone.View.extend({el:"#"+b.metaBoxID,events:{"click #submit-mlp-language":"sendRequest"},initialize:function(){this.$languages=this.$el.find('li [type="checkbox"]'),this.$menu=a("#menu"),this.$menuToEdit=a("#menu-to-edit"),this.$spinner=this.$el.find(".spinner"),this.$submit=this.$el.find("#submit-mlp-language")},sendRequest:function(c){var d;c.preventDefault(),this.$submit.prop("disabled",!0),this.$spinner.addClass("is-active").show(),d={action:b.action,menu:this.$menu.val(),mlp_sites:this.getSites()},d[b.nonceName]=b.nonce,a.post(b.ajaxURL,d,this.handleResponse.bind(this))},getSites:function(){var b=[];return this.$languages.filter(":checked").each(function(){b.push(a(this).val())}),b},handleResponse:function(a){a.success&&a.data&&this.$menuToEdit.append(a.data),this.$languages.prop("checked",!1),this.$spinner.addClass("is-active").hide(),this.$submit.prop("disabled",!1)}});MultilingualPress.registerModule("nav-menus.php","NavMenus",c)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"#wpbody-content form",events:{"change #site-language":"adaptLanguage","change #mlp-base-site-id":"togglePluginsRow"},template:_.template(a("#mlp-add-new-site-template").html()||""),initialize:function(){this.render(),this.$language=a("#mlp-site-language"),this.$pluginsRow=a("#mlp-activate-plugins").closest("tr")},render:function(){return this.$el.find(".submit").before(this.template()),this},adaptLanguage:function(b){var c=this.getLanguage(a(b.target));this.$language.find('[value="'+c+'"]').length&&this.$language.val(c)},getLanguage:function(a){var b=a.val();return b?b.replace("_","-"):"en-US"},togglePluginsRow:function(b){this.$pluginsRow.toggle(0<a(b.target).val())}});MultilingualPress.registerModule("network/site-new.php","AddNewSite",b)}(jQuery),function(a){"use strict";var b=Backbone.View.extend({el:"#post-body",events:{"click .mlp_copy_button":"copyPostData"},initialize:function(){this.$content=a("#content"),this.$excerpt=a("#excerpt"),this.$slug=a("#editable-post-name"),this.$title=a("#title")},copyPostData:function(b){var c="mlp_translation_data_"+this.getSiteID(a(b.target));b.preventDefault(),a("#"+c+"_title").val(this.getTitle()),a("#"+c+"_name").val(this.getSlug()),this.copyTinyMCEContent(c+"_content"),a("#"+c+"_content").val(this.getContent()),a("#"+c+"_excerpt").val(this.getExcerpt())},getSiteID:function(a){return a.data("blog_id")||0},getTitle:function(){return this.$title.val()||""},getSlug:function(){return this.$slug.text()||""},copyTinyMCEContent:function(a){var b,c;"undefined"!=typeof window.tinyMCE&&(b=window.tinyMCE.get("content"),b&&(c=window.tinyMCE.get(a),c&&c.setContent(b.getContent())))},getContent:function(){return this.$content.val()||""},getExcerpt:function(){return this.$excerpt.val()||""}});MultilingualPress.registerModule(["post.php","post-new.php"],"CopyPost",b)}(jQuery),function(a){"use strict";var b=MultilingualPress.getSettings("RelationshipControl"),c=Backbone.View.extend({el:"body",events:{"change .mlp_rsc_action_list input":"updateUnsavedRelationships","click #publish":"confirmUnsavedRelationships"},initialize:function(){this.unsavedRelationships=[]},updateUnsavedRelationships:function(b){var c=a(b.target),d=c.closest(".mlp_advanced_translator_metabox"),e=this.findMetaBox(d),f="stay"===c.val();-1===e?f||this.unsavedRelationships.push(d):f&&this.unsavedRelationships.splice(e,1)},findMetaBox:function(b){return a.each(this.unsavedRelationships,function(a,c){return c===b?a:void 0}),-1},confirmUnsavedRelationships:function(a){this.unsavedRelationships.length&&!confirm(b.L10n.unsavedRelationships)&&(a.preventDefault(),a.stopPropagation())}});MultilingualPress.registerModule(["post.php","post-new.php"],"RelationshipControl",c)}(jQuery),function(a,b){"use strict";a.fn.mlp_search=function(b){var c=a.extend({remote_blog_id:this.data("remote_blog_id"),remote_post_id:this.data("remote_post_id"),source_blog_id:this.data("source_blog_id"),source_post_id:this.data("source_post_id"),search_field:"input.mlp_search_field",result_container:"ul.mlp_search_results",action:"mlp_search",nonce:"",spinner:'<span class="spinner no-float" style="display:block"></span>'},b),d=a(c.result_container).html(),e=a(c.search_field),f=[],g=function(b){a(c.result_container).html(b)},h=function(b){if(f[b])return void g(f[b]);g(c.spinner);var d=a.post(ajaxurl,{action:c.action,source_post_id:c.source_post_id,source_blog_id:c.source_blog_id,remote_post_id:c.remote_post_id,remote_blog_id:c.remote_blog_id,s:b});d.done(function(a){f[b]=a,g(a)})};e.on("keypress",function(a){return 13==a.which?!1:void 0}).on("keyup",function(b){b.preventDefault(),b.stopPropagation();var c=a.trim(a(this).val());c&&0!==c.length?2<c.length&&h(c):g(d)})},a(".mlp_rsc_save_reload").on("click.mlp",function(c){c.preventDefault(),c.stopPropagation();var d=a(this),e=d.data("source_post_id"),f=d.data("source_blog_id"),g=d.data("remote_post_id"),h=d.data("remote_blog_id"),i=a('input[name="mlp_rsc_action['+h+']"]:checked').val(),j=0,k="",l=function(){o("disconnect")},m=function(){k=a('input[name="post_title"]').val(),o("new_relation")},n=function(){j=a('input[name="mlp_add_post['+h+']"]:checked').val(),j&&"0"!==j?o("connect_existing"):alert(b.L10n.noPostSelected)},o=function(b){a.ajax({type:"POST",url:ajaxurl,data:{action:"mlp_rsc_"+b,source_post_id:e,source_blog_id:f,remote_post_id:g,remote_blog_id:h,new_post_id:j,new_post_title:k},success:function(){window.location.reload(!0)},async:!1})};if(i&&"stay"!=i)switch(i){case"disconnect":l();break;case"new":m();break;case"search":n()}})}(jQuery,mlpRelationshipControlSettings),function(a){"use strict";var b=Backbone.View.extend({el:"#mlp-term-translations",events:{"change select":"propagateSelectedTerm"},initialize:function(){this.$selects=this.$el.find("select")},propagateSelectedTerm:function(b){var c,d;this.isPropagating||(this.isPropagating=!0,c=a(b.target),d=this.getSelectedRelation(c),""!==d&&this.$selects.not(c).each(function(b,c){this.selectTerm(a(c),d)}.bind(this)),this.isPropagating=!1)},getSelectedRelation:function(a){return a.find("option:selected").data("relation")||""},selectTerm:function(a,b){var c=a.find('option[data-relation="'+b+'"]');c.length?a.val(c.val()):this.getSelectedRelation(a)&&a.val(a.find("option").first().val())}});MultilingualPress.registerModule("edit-tags.php","TermTranslator",b)}(jQuery),function(){"use strict";var a=MultilingualPress.getSettings("UserBackendLanguage"),b=Backbone.View.extend({el:"#WPLANG",initialize:function(){this.$el.val(a.locale)}});MultilingualPress.registerModule("options-general.php","UserBackendLanguage",b)}();